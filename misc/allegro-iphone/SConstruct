import os

# From elias's xcodebuild for iphone
# /Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc-4.2 -x c -arch armv6 -fmessage-length=0 -pipe -Wno-trigraphs -fpascal-strings -O0 "-DCMAKE_INTDIR=\"Debug\"" -isysroot /Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk -gdwarf-2 -mthumb -miphoneos-version-min=4.3 -I/Users/elias/prog/git5/build-iphone/lib/Debug/include -I/Users/elias/prog/git5/include -I/Users/elias/prog/git5/build-iphone/include -I/Users/elias/prog/git5/build-iphone/ALLEGRO.build/Debug-iphoneos/allegro.build/DerivedSources/armv6 -I/Users/elias/prog/git5/build-iphone/ALLEGRO.build/Debug-iphoneos/allegro.build/DerivedSources -Wmost -Wno-four-char-constants -Wno-unknown-pragmas -F/Users/elias/prog/git5/build-iphone/lib/Debug -std=gnu99 -W -Wall -DDEBUGMODE=1 -DD3D_DEBUG_INFO -DALLEGRO_SRC -DALLEGRO_STATICLINK -DALLEGRO_LIB_BUILD -c /Users/elias/prog/git5/src/allegro.c -o /Users/elias/prog/git5/build-iphone/ALLEGRO.build/Debug-iphoneos/allegro.build/Objects-normal/armv6/allegro.o

# x86 build for the simulator
# /Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin/gcc-4.2 -x c -arch i386 -fmessage-length=0 -pipe -Wno-trigraphs -fpascal-strings -O0 "-DCMAKE_INTDIR=\"Debug\"" -isysroot /Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator4.3.sdk -fexceptions -fasm-blocks -mmacosx-version-min=10.6 -gdwarf-2 -D__IPHONE_OS_VERSION_MIN_REQUIRED=40300 -I/Users/elias/prog/git5/build-iphone/lib/Debug/include -I/Users/elias/prog/git5/include -I/Users/elias/prog/git5/build-iphone/include -I/Users/elias/prog/git5/build-iphone/ALLEGRO.build/Debug-iphonesimulator/allegro.build/DerivedSources/i386 -I/Users/elias/prog/git5/build-iphone/ALLEGRO.build/Debug-iphonesimulator/allegro.build/DerivedSources -Wmost -Wno-four-char-constants -Wno-unknown-pragmas -F/Users/elias/prog/git5/build-iphone/lib/Debug -std=gnu99 -W -Wall -DDEBUGMODE=1 -DD3D_DEBUG_INFO -DALLEGRO_SRC -DALLEGRO_STATICLINK -DALLEGRO_LIB_BUILD -c /Users/elias/prog/git5/src/allegro.c -o /Users/elias/prog/git5/build-iphone/ALLEGRO.build/Debug-iphonesimulator/allegro.build/Objects-normal/i386/allegro.o


env = Environment(ENV = os.environ)
env.VariantDir('build/', 'src')

gccversion = '4.0'
iostarget = '3.2'
osxtarget = '10.5'
 
platform_sim = 'iPhoneSimulator'
platform_phone = 'iPhoneOS'
 
arch_sim = 'i686'
arch_phone = 'armv6'
 
sim_bin_dir = '/Developer/Platforms/%s.platform/Developer/usr/bin' % platform_sim
platform_bin_dir = '/Developer/Platforms/%s.platform/Developer/usr/bin' % platform_phone

#TODO select platform or sim set to sim for now
env.PrependENVPath('PATH', sim_bin_dir)
 
sdkroot_sim = '/Developer/Platforms/%s.platform/Developer/SDKs/%s%s.sdk' % (platform_sim, platform_sim, iostarget)
sdkroot_phone = '/Developer/Platforms/%s.platform/Developer/SDKs/%s%s.sdk' % (platform_phone, platform_phone, iostarget)

postfix = '-%s' % gccversion
def setup(x, post):
	return '%s%s' % (x, post)
env['CC'] = setup('gcc', postfix)
env['LD'] = setup('ld', postfix)
env['CXX'] = setup('g++', postfix)
env['AS'] = setup('as', postfix)
env['AR'] = setup('ar', postfix)
env['OBJCOPY'] = setup('objcopy', postfix)

cflags =  Split("""
-g
-O2
-Wall
-Wmissing-prototypes
-std=c99
-ffast-math
-fno-strict-aliasing""")

cppflags = Split("""
-g
-O2
-Wall
-fno-strict-aliasing""")

includes = Split("""
include 
include/allegro5 
include/allegro5/inline 
include/allegro5/internal 
include/allegro5/opengl 
include/allegro5/platform 
src 
src/gp2xwiz 
src/iphone 
src/linux 
src/macosx 
src/misc 
src/opengl 
src/unix 
src/win 
src/x 
addons/primitives 
addons/primitives/allegro5 
addons/primitives/allegro5/internal""")

env.Append(CPATH = [includes])
env.Append(CFLAGS = [cflags])
env.Append(CPPFLAGS = [cppflags])

source = Split("""
build/allegro.c
build/display.c
build/file_slice.c
build/iphone/EAGLView.h
build/iphone/EAGLView.m
build/iphone/ViewController.h
build/iphone/ViewController.m
build/iphone/allegroAppDelegate.h
build/iphone/allegroAppDelegate.m
build/iphone/iphone.h
build/iphone/iphone_display.c
build/iphone/iphone_joystick.m
build/iphone/iphone_keyboard.c
build/iphone/iphone_main.m
build/iphone/iphone_mouse.m
build/iphone/iphone_path.m
build/iphone/iphone_system.c
build/iphone/iphone_touch_input.m
build/math.c src/opengl/extensions.c
build/opengl/ogl_bitmap.c
build/opengl/ogl_display.c
build/opengl/ogl_draw.c
build/threads.c
build/unix/udrvlist.c
build/unix/ufdwatch.c
build/unix/ugfxdrv.c
build/unix/ujoydrv.c
build/unix/ukeybd.c
build/unix/umodules.c
build/unix/umouse.c
build/unix/upath.c
build/unix/utime.c
build/unix/uxthread.c
build/bitmap.c
build/display_settings.c
build/file_stdio.c
build/joynu.c
build/memblit.c
build/optimized.c
build/timernu.c
build/utf8.c
build/bitmap_io.c
build/dtor.c
build/fshook.c
build/keybdnu.c
build/memdraw.c
build/path.c
build/tls.c
build/blenders.c
build/events.c
build/fshook_stdio.c
build/libc.c
build/memory.c
build/pixels.c
build/touch_input.c
build/x
build/config.c
build/evtsrc.c
build/misc/aatree.c
build/misc/bstrlib.c
build/misc/bstrlib.txt
build/misc/list.c
build/misc/vector.c
build/scanline_drawers.c
build/transformations.c
build/convert.c
build/file.c
build/inline.c
build/macosx/hidjoy-10.4.m
build/macosx/hidjoy.m
build/macosx/hidman.m
build/macosx/keybd.m
build/macosx/osx_app_delegate.m
build/macosx/osxgl.h
build/macosx/osxgl.m
build/macosx/qzmouse.m
build/macosx/system.m
build/mousenu.c
build/system.c
build/tri_soft.c
addons/primitives/directx_shaders.cpp
addons/primitives/high_primitives.c
addons/primitives/line_soft.c
addons/primitives/point_soft.c
addons/primitives/polygon.c
addons/primitives/polyline.c
addons/primitives/prim_directx.cpp
addons/primitives/prim_opengl.c
addons/primitives/prim_soft.c
addons/primitives/prim_util.c
addons/primitives/primitives.c
addons/primitives/triangulator.c
""")

env.Library('allegro', source)
